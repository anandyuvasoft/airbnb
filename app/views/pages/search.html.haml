#wrapper
  #sidebar
    #widget.sticky
      :javascript
        function initMap() {
                  var mapDiv = document.getElementById('widget');
                  var infowindow = null;
                  var map = new google.maps.Map(mapDiv, {
        <haml_silent>             if @arrRooms.length > 0 
        </haml_silent><haml_block>              center: {lat: #{@arrRooms[0].latitude}, lng: #{@arrRooms[0].longitude}},
        </haml_block><haml_silent>             else 
        </haml_silent><haml_block>              center: {lat: 44.5403, lng: -78,5463},
        </haml_block>
                    zoom: 10
                  });
        
        <haml_silent>           @arrRooms.each do |room| 
        </haml_silent><haml_block><haml_silent>             @photos = room.photos
        </haml_silent>            var marker = new google.maps.Marker({
                      position: {lat: #{room.latitude}, lng: #{room.longitude}},
                      title: "#{room.listing_name}",
                    
                     contentString: '<div id="content">'+
                    '<div id="siteNotice">'+
                    '</div>'+
                    '<div class="row">' +
                        '<div class="">' +
                          '<div id="myCarousel" class="carousel slide" data-ride="carousel">' +
                            '<haml_silent> if @photos </haml_silent><haml_block>' +
                              '<ol class="carousel-indicators">' +
                                '<haml_silent> @photos.each do |photo| </haml_silent><haml_block>' +
                                  '<li data-target="#myCarousel" data-slide-to="#{photo.id}"></li>' +
                                '</haml_block>' +
                              '</ol>' +
                            '</haml_block>' +
        
                            '<div class="carousel-inner" role="listbox">' +
                              '<haml_silent> if @photos </haml_silent><haml_block>' +
                                '<haml_silent> @photos.each do |photo| </haml_silent><haml_block>' +
                                  '<div class="item #{'active' if photo.id == @photos[0].id}">' +
                                    '<img src="#{photo.image.url()}" alt="Mountain View" style="width:190px;height:150px;">' +
                                  '</div>' +
                                '</haml_block>' +
                              '</haml_block>' +
                            '</div>' +
                            '<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">' +
                              '<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>' +
                              '<span class="sr-only">Previous</span>'+
                            '</a>'+
                            '<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">'+
                              '<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>' +
                              '<span class="sr-only">Next</span>' +
                            '</a>' +
                          '</div>' +
                        '</div>' +
                      '</div>' +
                    '<h3 id="firstHeading" class="firstHeading">#{room.listing_name}</h3>'+
                    '<h4 id="firstHeading" class="firstHeading">#{room.category}</h4>'+
                    '<div id="bodyContent">'+
                    '</div>'
                  });
                    marker.setMap(map);
                     marker.addListener('click', function() {
                        if (infowindow) {
                        infowindow.close();
                        }
                        infowindow = new google.maps.InfoWindow({
                        content: '<a href="/rooms">'+this.contentString+'</a>'
                      });
                      infowindow.open(map, this);
                     });
                    
        </haml_block>        }
      /
        <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
        async defer></script>
      %script{:async => "", :defer => "defer", :src => "https://maps.googleapis.com/maps/api/js?key=AIzaSyANqUD_Cbr7IantIEZIEIHNYEZ9gRMemdw&callback=initMap", :type => "text/javascript"}
  #article
    .row
      .col-md-12
        = search_form_for @search, url: search_path do |f|
          %hr/
          .row
            .col-md-4
              = f.select :city, [["miami","miami"], ["Texas City","Texas City"]], prompt: "Select...", class: "form-control"
            .col-md-4
              = f.select :category_eq, [["Plastic Surgery","Plastic Surgery"], ["category_2","category_2"]], include_blank: "Select Category...", class: "form-control"
          %hr/
          %br/
          .row
            = f.submit "Search", class: "btn btn-primary"
        %hr/
        .row
          - @arrRooms.each do |room|
            .col-md-6
              .panel.panel-default
                .panel-heading.preview
                  - if room.photos.length > 0
                    = image_tag room.photos[0].image.url(:medium)
                  - else
                    = image_tag("/assets/missing.png")
                .panel-body
                  = link_to room.listing_name, room
/
  <script>
  $(function() {
  $('#start_date').date_picker({
  dateFormat: 'dd-mm-yy',
  minDate: 0,
  maxDate: '3m',
  onSelect: function(selected) {
  $('#end_date').date_picker('option', 'minDate', selected);
  $('#end_date').attr('disabled', false);
  }
  });
  
  $('#end_date').date_picker({
  dateFormat: 'dd-mm-yy',
  minDate: 0,
  maxDate: '3m',
  onSelect: function(selected) {
  $('#start_date').date_picker('option', 'maxDate', selected);
  }
  });
  })
  </script>
:javascript
  $(function(){ // document ready
  if (!!$('.sticky').offset()) { // make sure ".sticky" element exists
    var stickyTop = $('.sticky').offset().top; // returns number
    $(window).scroll(function(){ // scroll event
      var windowTop = $(window).scrollTop(); // returns number
      if (stickyTop < windowTop){
        $('.sticky').css({ position: 'fixed', top: 0 });
      }
      else {
        $('.sticky').css('position','static');
      }
    });
  }
  });
